# Проект семантической сегментации изображений с использованием U-Net

Проект предназначен для семантической сегментации изображений с использованием архитектуры U-Net. Решение поддерживает 
обучение на пользовательских данных, аугментацию, оценку качества через метрики (IoU, Accuracy, Precision) и визуализацию
результатов.

## Содержание
1. [Установка](#установка)
2. [Подготовка данных](#подготовка-данных)
3. [Запуск обучения](#запуск-обучения)
4. [Структура проекта](#структура-проекта)
5. [Настройки параметров](#настройки-параметров)
6. [Результаты и визуализация](#результаты-и-визуализация)
7. [Лицензия](#лицензия)
8. [Контакты](#контакты)

---

## Установка

### Зависимости
Для работы проекта необходимы следующие библиотеки:
- Python 3.8+ (работоспособность проверена на 3.12 Windows 10, Windows 11, Ubuntu 24.04)
- PyTorch 2.0+
- Albumentations
- Pillow
- NumPy
- TorchMetrics
- Matplotlib
- TensorBoard

Установите зависимости:
```bash
pip install torch albumentations pillow numpy torchmetrics matplotlib tensorboard
```

### Клонирование репозитория
```bash
git clone git@github.com:AndreyNik1994/ImageSegmentation_UNet_PyTorch.git
cd ImageSegmentation_UNet_PyTorch
```

---

## Подготовка данных

### Структура датасета
- Обучающие данные должны находиться в папке `images/`:
  ```
  images/
    original/       # Исходные изображения
    mask/           # Маски (аннотации)
  ```
- Тестовые данные — в папке `test_images/` с аналогичной структурой.

### Требования к данным
- Изображения и маски должны иметь одинаковые имена.
- Поддерживаемые форматы: PNG, TIFF, JPEG.
- Маски должны быть в формате RGB, где каждый цвет соответствует определённому классу (см. `params.py`).
- Цвет масок должен быть записан в соответствующий класс в 'params.py'
- ВАЖНО: Изображения должны быть кратны PATCH_SIZE, т.е. при PATCH_SIZE=(512, 512) следует использовать изображения разрешением (1024, 1024), (2048, 2048) и т.д.
- При изменении PATCH_SIZE необходимо проверить требования к разрешению изображений.

---

## Запуск обучения

1. **Настройка параметров**  
   Отредактируйте файл `params.py`:
   - `DATASET_PATH` — путь к обучающим данным.
   - `TEST_DATASET_PATH` — путь к тестовым данным.
   - Гиперпараметры: `BATCH_SIZE`, `LEARNING_RATE`, `NUM_EPOCHS` и др.

2. **Запуск скрипта**  
   Выполните команду:
   ```bash
   python main_backup.py
   ```
---

## Структура проекта
```
.
├── dataset_loader.py    # Загрузка данных и создание патчей
├── general_func.py      # Вспомогательные функции
├── main.py       # Основной скрипт обучения
├── model.py      # Архитектура U-Net
├── params.py            # Конфигурационные параметры
├── transforms.py        # Аугментации данных
├── images/              # Обучающие данные
├── test_images/         # Тестовые данные
└── Models/              # Сохранённые модели
```

---

## Настройки параметров
Основные параметры в `params.py`:
- **Данные**:
  - `PATCH_SIZE`: размер патчей (по умолчанию 512x512).
  - `VAL_SPLIT`: доля данных для валидации.
- **Модель**:
  - `ENCODER_CHANNELS`: каналы в слоях U-Net.
  - `IN_CHANNELS`: 1 (градации серого) или 3 (RGB).
- **Обучение**:
  - `NUM_EPOCHS`: количество эпох.
  - `LEARNING_RATE`: начальная скорость обучения.

---

## Результаты и визуализация

### Метрики
После обучения генерируются графики:
- Loss (потери)
- IoU (Intersection over Union)
- Accuracy (точность)

Графики сохраняются в файл `training_history_epoch_[X].png`.

### Визуализация предсказаний
Примеры предсказаний сохраняются в `predictions.png`.  
Для тестирования используется датасет из `test_images/`.

---

## Лицензия
Проект распространяется под лицензией [MIT](LICENSE).

---

## Контакты
Автор: Андрей Никитёнок / Andreyt Nikityonok 
Email: nikitenoka@gmail.com
GitHub: https://github.com/AndreyNik1994
```



Примеры моделей, работспособность которых проверялась:
PATCH_SIZE = (512, 512)
VAL_SPLIT = 0.15 
BATCH_SIZE = 4
N_REPEATS = 16
ENCODER_CHANNELS = [16, 32, 64, 128, 256, 512]
IN_CHANNELS = 1 (и 3)
OUT_CLASSES = 4
NUM_EPOCHS = 100-1000 (~ после 250 плато)
LEARNING_RATE = 1e-4 или 1е-5

Время обучения NVIDIA 3060 12GB ~


